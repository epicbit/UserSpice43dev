BUILD NOTES STATUS 31-my push!

NOTES
Added {{hr}} in DB-driven nav for dropdowns

Changed the whole DB-driven nav to match the current format and style of the non DB-driven nav

Added {{username}} to the itemString prepare in the menus.php file

Added {{notifications}} and {{messages}} to the db-driven navbar

The navbar was using checkMenu on the ID of the nav item which was causing non-master users to see only menu items with IDs within their perm levels...e.g. menu ID 2 was showing up for non-master admins. I migrated the function to hasPerm and added the appropriate criteria which resolved the issue.

Had to repair the logic on admin_menu_item.php for permissions. There was no value attribute on the checkboxes which was causing the updates to be the Array ID which would be in order (e.g. 1, 2, 3) but if you selected Perm 0 and 2, it would add for 0 and 1 due to the array ID. I added a value and removed the array_keys.

There was no logic for checking permissions within a dropdown. It simply inherited whatever the dropdown was...I added user_id logic and checking from the database nav file into the menu helpers.

Added a show for both recapatchas on the admin panel for anyone within the master account.

I switched the nav back to match the Divs of the non-db driven nav so it works right with the bootstrap corrections and the msg box does not show up above the navbar.

I fixed the email_settings page there was no query so it was dying. I removed the redirect when you are not testing and fixed the error by adding isset(). I also added the errors and successes block.

Added PHP and HTML for notif_daylimit and added the notifications on/off setting. I didn't bother wrapping the settings but just rather did the button in the menu.

Added the custom file for settings on admin_user.php and added the checks to hide/show the button and put an example of the custom file.

SQL
ALTER TABLE `menus` CHANGE `id` `id` INT(10) NOT NULL AUTO_INCREMENT
ALTER TABLE `settings` ADD `notifications` INT(1) NOT NULL DEFAULT '0' AFTER `msg_default_to`;

BUILD NOTES STATUS 29

UPDATES
  users
    views
      _admin_login_settings.php - Fixed a glogin select issue, it said "sele3cted" which was causing it to always say enabled
    admin.php - added navigation manager button

BUILD NOTES STATUS 28

UPDATES
  users
    helpers
      class.treeManager.php - corrected Line 80 per Karsen
      us_helpers.php - corrected checkMenu class per Karsen
      language.php - added language keys from Nav that were removed

    css
      sb-admin.css - Karsens corrections - added to this

    includes
      navigation.php - reversed to default, added an if for the nav type
      database-navigation.php - added two classes, navbar-noborder and re-added navbar-inverse

    profile.php - Fixed page per Karsen
    admin.php - Updated to remove PHP for css_sample - per Karsen, added PHP for new setting
    _admin_site_settings.php - Added HTML for new setting
    admin_menu.php - There was a double call for die() on securePage, removed

SQL
ALTER TABLE `groups_menus` CHANGE `id` `id` INT(11) NOT NULL AUTO_INCREMENT;
ALTER TABLE `settings` ADD `navigation_type` INT(1) NOT NULL DEFAULT '1' AFTER `page_default_private`;

BUILD NOTES STATUS 22

UPDATES
  users
    profile.php - Added line break after "All Users"
    mqtt_settings.php - Added line break after "Add MQTT Server"
    verify.php - Added logger
    verify_resend.php - Added logger
    forgot_password_reset.php - Added logger
    email_settings.php - Added line break after submit buttons

BUILD NOTES STATUS 19

UPDATES
  users
    admin.php
      -Fixed a logtype of "Setting Changed", it should be "Setting Change"
    helpers
      us_helpers.php
        -Fixed a bug in the logger (was calling the wrong name)
    message.php - Added missing logger
    messages.php - Added missing logger
    admin_messages.php - Added setting for default hidden_from

SQL
ALTER TABLE `settings` ADD `msg_default_to` INT(1) NOT NULL DEFAULT '1' AFTER `msg_blocked_users`;

BUILD NOTES STATUS 15

UPDATES
  users
    admin_backup.php
      -Added all loggers
      -Fixed select all divs
      -Changed the deletions success message, commented out original
      -Added line break after delete button
    admin_messages.php
      -Fixed pagnation bug by adding an extra table header
      -Added all loggers
      -Fixed issue with deleted user gravs and names
    admin_message.php
      -Fixed issue with deleted user gravs and names
    admin_page.php
      -Added all loggers
    admin_permission.php
      -Added loggers
      -Added success note for changing permission name
      -Fixed a call for errors and successes which was overwriting the success and errors that were defined
    admin_permissions.php
      -Added logger
      -Had to remove the call to verify if in array since there was no $permissionId
      -Removed delete call and functions
      -Moved submit button to top next to add permission level name
    admin_user.php
      -Added loggers
    admin_users.php
      -Removed delete function as this is legacy
      -Added logger
    admin_verify.php
      -Added logger
    admin.php
      -Split register and social since they are in their own tabs
      -Commented redirect calls for success messages - they were doing the same thing as they currently were anyways
      -Added a recall for $settings so we have updated on post
    cron_manager.php
      -Added logger
      -Changed active=0 bg color to #CDCDCD
    cron_post.php
      -Added logger
    email_settings.php
      -Added loggers
      -Added msg on redirect
      -Need to find out where the $results comes from and add success and errors results
      -Will change the redirect for no test to just recall $results
    forgot_password.php
      -Added logger
    join.php
      -Added loggers
    message.php
      -Fixed call with deleted users gravs and names
      -Added an error message and disabled attribute if the message was deleted by the other user, restricted sending in case of manual edits
    messages.php
      -Fixed call with deleted users gravs and names
    user_settings.php
      -Added loggers
    views
      _admin_register_settings.php
        -Change call from social to register
      _admin_site_settings.php
        -Fixed action to be to 2 tab instead of 1
    helpers
      us_helpers.php
        -Modified adminArchiveThread - added logger, add user_id
        -Modified adminUnarchiveThread - added logger, add user_id
        -Modified adminDeleteThread - added logger, add user_id
        -Modified messageUser - added logger, add user_id
        -Modified archiveThreads - added logger, add user_id
        -Modified deleteThreads - added logger, add user_id

DELETIONS
  users
    create_message.php - legacy

**PLEASE ADD**
logger on login:
logger($user->data()->id,"User","User logged in.");

**SQL**
INSERT INTO `crons` (`id`, `active`, `sort`, `name`, `file`, `createdby`, `created`, `modified`) VALUES (NULL, '0', '100', 'Auto-Backup', 'backup.php', '1', CURRENT_TIMESTAMP, NULL);
